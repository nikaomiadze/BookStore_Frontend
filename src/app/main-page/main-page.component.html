<div class="main-page">
<div class="header">
    <div class="title">
    <h2>მაღაზია</h2>
    <h2>მომხმარებელი</h2>
    </div>
    <div class="nav">
        <div class="nav-1">
            <div class="book-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M3 17.15V10C3 9.46667 3.19583 9.01667 3.5875 8.65C3.97917 8.28333 4.44167 8.11667 4.975 8.15C6.29167 8.35 7.54583 8.7375 8.7375 9.3125C9.92917 9.8875 11.0167 10.6333 12 11.55C12.9833 10.6333 14.0708 9.8875 15.2625 9.3125C16.4542 8.7375 17.7083 8.35 19.025 8.15C19.5583 8.11667 20.0208 8.28333 20.4125 8.65C20.8042 9.01667 21 9.46667 21 10V17.15C21 17.6833 20.825 18.1375 20.475 18.5125C20.125 18.8875 19.6833 19.0917 19.15 19.125C18.0833 19.2917 17.05 19.5667 16.05 19.95C15.05 20.3333 14.1167 20.8417 13.25 21.475C13.0667 21.625 12.8708 21.7375 12.6625 21.8125C12.4542 21.8875 12.2333 21.925 12 21.925C11.7667 21.925 11.5458 21.8875 11.3375 21.8125C11.1292 21.7375 10.9333 21.625 10.75 21.475C9.88333 20.8417 8.95 20.3333 7.95 19.95C6.95 19.5667 5.91667 19.2917 4.85 19.125C4.31667 19.0917 3.875 18.8875 3.525 18.5125C3.175 18.1375 3 17.6833 3 17.15ZM12 19.9C13.05 19.1167 14.1667 18.4917 15.35 18.025C16.5333 17.5583 17.75 17.25 19 17.1V10.2C17.7833 10.4167 16.5875 10.8542 15.4125 11.5125C14.2375 12.1708 13.1 13.05 12 14.15C10.9 13.05 9.7625 12.1708 8.5875 11.5125C7.4125 10.8542 6.21667 10.4167 5 10.2V17.1C6.25 17.25 7.46667 17.5583 8.65 18.025C9.83333 18.4917 10.95 19.1167 12 19.9ZM12 9C10.9 9 9.95833 8.60833 9.175 7.825C8.39167 7.04167 8 6.1 8 5C8 3.9 8.39167 2.95833 9.175 2.175C9.95833 1.39167 10.9 1 12 1C13.1 1 14.0417 1.39167 14.825 2.175C15.6083 2.95833 16 3.9 16 5C16 6.1 15.6083 7.04167 14.825 7.825C14.0417 8.60833 13.1 9 12 9ZM12 7C12.55 7 13.0208 6.80417 13.4125 6.4125C13.8042 6.02083 14 5.55 14 5C14 4.45 13.8042 3.97917 13.4125 3.5875C13.0208 3.19583 12.55 3 12 3C11.45 3 10.9792 3.19583 10.5875 3.5875C10.1958 3.97917 10 4.45 10 5C10 5.55 10.1958 6.02083 10.5875 6.4125C10.9792 6.80417 11.45 7 12 7Z" fill="white"/>
                  </svg>
            </div>
            <h1>წიგნების ჩამონათვალი:</h1>
        </div>
        <div class="nav-2" *ngIf="!loggedin">
            <a class="a" (click)="openPopup('login')">შესვლა</a>
            <a class="a" (click)="openPopup('register')">რეგისტრაცია</a>
        </div>
        <div class="cart-btn" *ngIf="loggedin">
            <p-button label=" ჩემი კალათა / შეკვეთები ( 3 )">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M7 22C6.45 22 5.97917 21.8042 5.5875 21.4125C5.19583 21.0208 5 20.55 5 20C5 19.45 5.19583 18.9792 5.5875 18.5875C5.97917 18.1958 6.45 18 7 18C7.55 18 8.02083 18.1958 8.4125 18.5875C8.80417 18.9792 9 19.45 9 20C9 20.55 8.80417 21.0208 8.4125 21.4125C8.02083 21.8042 7.55 22 7 22ZM17 22C16.45 22 15.9792 21.8042 15.5875 21.4125C15.1958 21.0208 15 20.55 15 20C15 19.45 15.1958 18.9792 15.5875 18.5875C15.9792 18.1958 16.45 18 17 18C17.55 18 18.0208 18.1958 18.4125 18.5875C18.8042 18.9792 19 19.45 19 20C19 20.55 18.8042 21.0208 18.4125 21.4125C18.0208 21.8042 17.55 22 17 22ZM3 4H2C1.71667 4 1.47917 3.90417 1.2875 3.7125C1.09583 3.52083 1 3.28333 1 3C1 2.71667 1.09583 2.47917 1.2875 2.2875C1.47917 2.09583 1.71667 2 2 2H3.65C3.83333 2 4.00833 2.05 4.175 2.15C4.34167 2.25 4.46667 2.39167 4.55 2.575L8.525 11H15.525L19.15 4.5C19.2333 4.33333 19.35 4.20833 19.5 4.125C19.65 4.04167 19.8167 4 20 4C20.3833 4 20.6708 4.1625 20.8625 4.4875C21.0542 4.8125 21.0583 5.14167 20.875 5.475L17.3 11.95C17.1167 12.2833 16.8708 12.5417 16.5625 12.725C16.2542 12.9083 15.9167 13 15.55 13H8.1L7 15H18C18.2833 15 18.5208 15.0958 18.7125 15.2875C18.9042 15.4792 19 15.7167 19 16C19 16.2833 18.9042 16.5208 18.7125 16.7125C18.5208 16.9042 18.2833 17 18 17H7C6.25 17 5.67917 16.675 5.2875 16.025C4.89583 15.375 4.88333 14.7167 5.25 14.05L6.6 11.6L3 4ZM12.175 7H9C8.71667 7 8.47917 6.90417 8.2875 6.7125C8.09583 6.52083 8 6.28333 8 6C8 5.71667 8.09583 5.47917 8.2875 5.2875C8.47917 5.09583 8.71667 5 9 5H12.175L11.275 4.1C11.075 3.9 10.9792 3.66667 10.9875 3.4C10.9958 3.13333 11.1 2.9 11.3 2.7C11.5 2.51667 11.7333 2.42083 12 2.4125C12.2667 2.40417 12.5 2.5 12.7 2.7L15.3 5.3C15.5 5.5 15.6 5.73333 15.6 6C15.6 6.26667 15.5 6.5 15.3 6.7L12.7 9.3C12.5167 9.48333 12.2875 9.57917 12.0125 9.5875C11.7375 9.59583 11.5 9.5 11.3 9.3C11.1167 9.11667 11.025 8.88333 11.025 8.6C11.025 8.31667 11.1167 8.08333 11.3 7.9L12.175 7Z" fill="white"/>
              </svg>
            </p-button>
        </div>
    </div>

</div>
<div class="books">
    <p-card *ngFor="let product of products">
        <ng-template pTemplate="content">
        <div>
        <img src="img/book-png-10 1.png" alt="book">
        </div>
        <div class="item-info">
            <p>დასახელება: {{ product.book_name }}</p>
            <p>ავტორი: {{ product.author }}</p>
            <p>რაოდენობა: {{ product.quantity }}</p>
            <p>ფასი: {{ product.price }}</p>
            <p-inputnumber [(ngModel)]="productValues[product.book_name]" [showButtons]="true" buttonLayout="horizontal" spinnerMode="vertical"  [min]="0" [max]="product.quantity"
            [inputStyle]="{ width: '3rem' }">
                <ng-template #incrementbuttonicon>
                    <span class="pi pi-plus" [ngClass]="{ 'disabled': productValues[product.book_name] >= product.quantity}"></span>
                </ng-template>
                <ng-template #decrementbuttonicon>
                    <span class="pi pi-minus" [ngClass]="{ 'disabled': productValues[product.book_name] <= 0 }"></span>
                </ng-template>
            </p-inputnumber>
            <p-button (onClick)="addToCart(product)" [ngClass]="{ 'disabled': productValues[product.book_name] <= 0 }" icon="pi pi-shopping-cart" label="კალათაში დამატება"></p-button>
        </div>
        </ng-template>
    </p-card>
</div>
<div *ngIf="popupVisible" class="popup-overlay" (click)="closePopup()">
    <div class="popup" (click)="$event.stopPropagation()">
        <div class="popup-header">
        <h3>{{ popupTitle }}</h3>
        <button class="close-btn" (click)="closePopup()">
            <i class="pi pi-times"></i> 
        </button>
        </div>

        <!-- Content for login pop-up -->
        <div *ngIf="popupType === 'login'" class="login-popup">
            <form [formGroup]="LoginForm" (ngSubmit)="authenticate()">
                <label for="email">ელ-ფოსტა</label>
                <input type="email" id="email" name="email" formControlName="email">
                <label for="password">პაროლი</label>
                <input type="password" id="password" name="password" formControlName="password">
                <button type="submit">შესვლა</button>
            </form>
        </div>

        <!-- Content for registration pop-up -->
        <div *ngIf="popupType === 'register'" class="register-popup">
            <form [formGroup]="registerForm" (ngSubmit)="AddUser()">
                <label for="username">სახელი</label>
                <input type="text" id="username" name="username" formControlName="user_name">
                <label for="email">ელ-ფოსტა</label>
                <input type="email" id="email" name="email" formControlName="email">
                <label for="password">პაროლი</label>
                <input type="password" id="password" name="password" formControlName="password">
                <button type="submit" [disabled]="!registerForm.valid">რეგისტრაცია</button>
            </form>
        </div>

    </div>
</div>

</div>

